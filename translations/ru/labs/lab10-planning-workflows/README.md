# Lab 10: Планирование и Workflow

## Цель
Научиться реализовывать паттерны планирования: декомпозиция задач, разрешение зависимостей, выполнение плана с повторами и персистентность состояния.

## Теория

### Паттерны Планирования

Когда агенты обрабатывают сложные многошаговые задачи, им нужно планирование:
- **Декомпозиция задач** — Разбить большую задачу на шаги
- **Граф зависимостей** — Понять зависимости между шагами
- **Порядок выполнения** — Выполнять шаги с учетом зависимостей
- **Отслеживание состояния** — Знать, что сделано, что ожидает
- **Обработка ошибок** — Повторять, пропускать или прерывать при ошибках

См. подробнее: [Глава 10: Planning и Workflow-паттерны](../../book/10-planning-and-workflows/README.md)

## Задание

В файле `main.go` реализуйте систему планирования для сложных задач.

### Часть 1: Декомпозиция Задач

Реализуйте функцию `createPlan(task string) (*Plan, error)`:
- Используйте LLM для декомпозиции задачи на шаги
- Определите зависимости между шагами
- Верните Plan с шагами и зависимостями

### Часть 2: Разрешение Зависимостей

Реализуйте функцию `findReadySteps(plan *Plan) []*Step`:
- Верните шаги, все зависимости которых выполнены
- Обработайте циклические зависимости (обнаружить и вернуть ошибку)

### Часть 3: Выполнение Плана с Повторами

Реализуйте функцию `executePlanWithRetries(plan *Plan, executor StepExecutor, maxRetries int) error`:
- Выполняйте шаги с учетом зависимостей
- Повторяйте неудачные шаги до maxRetries
- Обрабатывайте ошибки корректно

### Часть 4: Персистентность Состояния

Реализуйте функцию `savePlanState(planID string, plan *Plan) error`:
- Сохраните состояние плана в файл
- Включите возобновление плана после прерывания

## Критерии сдачи

✅ **Сдано:**
- Декомпозиция задач реализована
- Разрешение зависимостей работает корректно
- Выполнение плана с повторами
- Персистентность состояния реализована
- Можно возобновить прерванные планы

❌ **Не сдано:**
- Шаги выполняются без проверки зависимостей
- Нет персистентности состояния
- Бесконечные повторы без лимитов

---

**Следующий шаг:** После завершения Lab 10 переходите к [Lab 11: Память и Управление Контекстом](../lab11-memory-context/README.md).
