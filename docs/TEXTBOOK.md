# Учебник: Проектирование Автономных AI Агентов

**Версия:** 1.0
**Для курса:** DevOps AI Agent Course

---

## Оглавление
1.  [Введение: Смена парадигмы](#1-введение)
2.  [Глава 1: Физика LLM](#2-глава-1-физика-llm)
3.  [Глава 2: Промптинг как Программирование](#3-глава-2-промптинг-как-программирование)
4.  [Глава 3: Анатомия Агента](#4-глава-3-анатомия-агента)
5.  [Глава 4: Инструменты (Tools)](#5-глава-4-инструменты-tools)
6.  [Глава 5: Архитектуры и Паттерны](#6-глава-5-архитектуры-и-паттерны)
7.  [Глава 6: Надежность и Тестирование](#7-глава-6-надежность-и-тестирование)
8.  [Карта Лабораторных Работ](#8-карта-лабораторных-работ)

---

## 1. Введение

### Что такое AI Agent?
В классическом программировании вы пишете алгоритм: "Если А, то Б".
В AI Engineering вы описываете **Цель** и даете **Инструменты**. Агент сам строит алгоритм достижения цели в реальном времени.

> **Определение:** Агент — это система, использующая LLM в качестве "движка рассуждений" (Reasoning Engine) для восприятия окружения, принятия решений и выполнения действий.

### Отличие от ChatGPT
*   **ChatGPT:** Пассивен. Отвечает на вопрос и ждет.
*   **Agent:** Активен. Имеет цикл (Loop). Может выполнить 10 действий подряд, чтобы решить одну задачу пользователя (например, "Почини сайт").

---

## 2. Глава 1: Физика LLM

Чтобы управлять агентом, нужно понимать, как работает его "мозг".

### 2.1 Вероятностная природа
LLM — это функция `NextToken(Context) -> Distribution`.
Она не знает "истины". Она знает, какое слово *вероятнее всего* идет следующим.
*   **Токен:** Единица текста (часть слова). ~0.75 слова.
*   **Температура (Temperature):** Параметр энтропии.
    *   `Temp = 0`: Модель всегда выбирает самый вероятный токен. Поведение детерминировано (почти). **Используется для агентов.**
    *   `Temp = 1`: Модель выбирает случайно из топа. Поведение креативно, но нестабильно.

### 2.2 Контекстное окно (Context Window)
Это "оперативная память" модели.
*   Все, что агент "знает" о текущей задаче — это то, что влезает в контекстное окно (Prompt + History).
*   Модель **Stateless**. Она не помнит ваш прошлый запрос, если вы не передали его снова в `messages`.

---

## 3. Глава 2: Промптинг как Программирование

Промпт — это код для нейросети.

### 3.1 Структура Промпта
Хороший System Prompt состоит из блоков:
1.  **Role (Persona):** "Ты Senior DevOps Engineer."
2.  **Goal:** "Твоя цель — восстановить работоспособность сервисов."
3.  **Constraints (Ограничения):** "Никогда не используй `rm -rf /`. Всегда спрашивай подтверждение."
4.  **Format:** "Отвечай в формате JSON."
5.  **SOP (Standard Operating Procedure):** Алгоритм действий (см. Lab 06).

### 3.2 In-Context Learning (ICL)
Это способность модели обучаться на примерах *внутри промпта*, без переобучения весов.
*   **Zero-Shot:** Без примеров.
*   **Few-Shot:** С примерами.
    ```text
    User: Check logs.
    Agent: {"tool": "read_logs"}
    User: Restart server.
    Agent: {"tool": "restart"}
    ```
    Few-Shot радикально повышает надежность выполнения инструкций.

### 3.3 Chain-of-Thought (CoT)
Техника "Думай по шагам".
Заставляя модель генерировать промежуточные рассуждения ("Сначала я проверю X, потому что..."), мы увеличиваем точность.
*   *Математика:* Промежуточные токены меняют контекст $C$, делая вероятность правильного финального токена $P(Answer|C_{new})$ выше, чем $P(Answer|C_{old})$.

---

## 4. Глава 3: Анатомия Агента

Уравнение агента:
$$ Agent = LLM + Memory + Tools + Planning $$

### 4.1 Memory (Память)
1.  **Short-term:** История сообщений (`messages` array). Ограничена контекстным окном.
2.  **Long-term:** Векторная база данных (RAG). Позволяет хранить гигабайты доков и находить нужное по смыслу (Semantic Search).

### 4.2 Planning (Планирование)
Способность разбить задачу "Сделай хорошо" на шаги.
*   **ReAct (Reason+Act):** "Подумал -> Сделал -> Посмотрел результат -> Повторил".
*   **Reflexion:** "Сделал -> Ошибся -> Понял причину -> Попробовал иначе".

---

## 5. Глава 4: Инструменты (Tools)

Инструменты превращают LLM из болтуна в работника.

### 5.1 Function Calling
Механизм, при котором LLM возвращает не текст, а структурированный JSON с именем функции и аргументами.
1.  Вы описываете функцию: `name: "ping", args: { "host": "string" }`.
2.  LLM генерирует: `{"name": "ping", "arguments": "{\"host\": \"google.com\"}"}`.
3.  Ваш код (Runtime) парсит JSON, выполняет `exec.Command("ping")` и возвращает результат в LLM.

### 5.2 Ошибки
Если инструмент вернул ошибку (`Connection refused`), агент должен это увидеть и обработать (например, попробовать другой хост). Ошибка — это тоже результат.

---

## 6. Глава 5: Архитектуры и Паттерны

### 6.1 Single Agent
Один цикл, один промпт. Подходит для простых задач.

### 6.2 Multi-Agent Systems (MAS)
Для сложных задач один агент переполняется контекстом и начинает путаться.
**Паттерн Supervisor:**
*   Главный агент (Supervisor) только раздает задачи.
*   Агенты-исполнители (Workers) делают работу.
*   *Изоляция контекста:* Worker не видит всей переписки Supervisor-а, только свою задачу. Это экономит токены и фокусирует внимание.

---

## 7. Глава 6: Надежность и Тестирование

### 7.1 Evals (Evaluations)
Как понять, что агент не деградировал после правки промпта?
Нужен набор Unit-тестов для агента (Dataset: Вопрос -> Ожидаемое действие).
См. `Lab 00`.

### 7.2 Human-in-the-Loop
Агент не должен иметь права на ядерный удар.
Критические функции (`delete`, `deploy`) должны быть защищены:
*   Агент запрашивает действие.
*   Система ставит на паузу.
*   Человек нажимает "Approve".
*   Система выполняет и возвращает результат агенту.

---

## 8. Карта Лабораторных Работ

| Lab | Тема | Ключевые навыки |
| :--- | :--- | :--- |
| **Lab 00** | **Capability Check** | Проверка модели. Unit-тесты для LLM. |
| **Lab 01** | **Basics** | OpenAI API, Chat Loop, Memory Management. |
| **Lab 02** | **Tools** | Определение функций (JSON Schema), парсинг ToolCalls. |
| **Lab 03** | **Architecture** | Интерфейсы Go, паттерн Registry, Mocking. |
| **Lab 04** | **Autonomy (ReAct)** | Цикл `Think-Act-Observe`. Обработка результатов. |
| **Lab 05** | **Human-in-Loop** | Интерактивность. Уточняющие вопросы. Safety. |
| **Lab 06** | **Incident (SOP)** | Сложное планирование. Внедрение SOP в промпт. |
| **Lab 07** | **RAG** | Работа с документацией. Поиск знаний перед действием. |
| **Lab 08** | **Multi-Agent** | Оркестрация. Делегирование задач. Изоляция контекста. |

---
**Рекомендация:** Держите этот учебник открытым во время прохождения лабораторных работ.

