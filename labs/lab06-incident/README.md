# Lab 06: Инцидент-Менеджмент (Advanced Planning)

## Цель
Создать агента уровня SRE, способного самостоятельно расследовать и устранять сбои, используя **явное планирование** (Plan-and-Solve) и SOP (Standard Operating Procedure).

## Теория

### Planning (Планирование) — разбиение задачи на шаги

В этой лабе мы используем **явное планирование** (Plan-and-Solve), в отличие от имплицитного планирования (ReAct) из Lab 04.

**Разница:**

**Имплицитное планирование (ReAct) — Lab 04:**
- Агент планирует "на лету"
- Подходит для простых задач (2-4 шага)
- Пример: "Проверь диск" → "Очисти логи" → "Проверь снова"

**Явное планирование (Plan-and-Solve) — Lab 06:**
- Агент сначала создает полный план
- Затем выполняет план по пунктам
- Подходит для сложных задач (5+ шагов)
- Пример: "План: 1. Проверить HTTP 2. Читать логи 3. Анализировать 4. Фиксить 5. Верифицировать"

### SOP (Standard Operating Procedure)

**SOP** — это алгоритм действий, закодированный в промпте. Это как устав для солдата: четкие инструкции, что делать в каждой ситуации.

**Пример SOP для инцидента:**
```
SOP для падения сервиса:
1. Check Status: Проверь HTTP код ответа
2. Check Logs: Если 500/502 — читай последние 20 строк логов
3. Analyze: Найди ключевые слова:
   - "Syntax error" → Rollback
   - "Connection refused" → Check Database
   - "Out of memory" → Restart
4. Action: Примени фикс согласно анализу
5. Verify: Проверь HTTP статус снова
```

**Почему SOP важен?**

Без SOP модель видит: `User: Fix it`. Ее вероятностный механизм может выдать: `Call: restart_service`. Это самое "популярное" действие.

С SOP модель вынуждена сгенерировать текст:
- "Step 1: I need to check HTTP status." → Это повышает вероятность вызова `check_http`
- "HTTP is 502. Step 2: I need to check logs." → Это повышает вероятность вызова `read_logs`

Мы **направляем внимание** модели по нужному руслу.

### Декомпозиция задачи

Задача "Разберись с инцидентом" разбивается на подзадачи:

1. **Диагностика:** Что случилось?
   - Проверить статус сервиса
   - Прочитать логи
   - Проанализировать ошибки

2. **Решение:** Как исправить?
   - Определить причину
   - Выбрать правильное действие (rollback/restart/scale)
   - Применить фикс

3. **Верификация:** Помогло ли решение?
   - Проверить статус снова
   - Убедиться, что проблема решена

**Принципы декомпозиции:**
- **Атомарность:** Каждый шаг выполним одним действием
- **Зависимости:** Шаги выполняются в правильном порядке
- **Проверяемость:** Каждый шаг имеет четкий критерий успеха

## Задание
В `main.go` — большой каркас.

1. **Tools:** У вас есть 4 инструмента:
   - `check_http` — проверка HTTP статуса
   - `read_logs` — чтение логов сервиса
   - `restart_service` — перезапуск сервиса
   - `rollback_deploy` — откат к предыдущей версии

2. **SOP в промпте:** Добавьте в System Prompt детальный SOP для обработки инцидента.

3. **The Loop:** Реализуйте цикл агента, который следует SOP строго.

4. **Scenario:** Запустите агента с промптом: *"Payment Service is down (502). Fix it."*
   - Ожидание: Агент следует SOP:
     - Проверяет HTTP → 502
     - Читает логи → "Syntax error"
     - Делает rollback (не restart!)
     - Верифицирует → 200 OK

## Важно
- Агент должен **следовать SOP строго**, а не гадать
- Агент должен **читать логи перед действием**, а не сразу рестартить
- Агент должен **верифицировать результат** после фикса

When you're done with your current set of changes to this file, you should call the read_lints tool with the specific file path and fix any newly introduced errors.